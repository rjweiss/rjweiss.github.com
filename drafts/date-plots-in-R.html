<!DOCTYPE html>
<html lang="en"
>
<head>
    <title>Simple plots using date data - Rebecca Weiss</title>
    <!-- Using the latest rendering mode for IE -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">



<link rel="canonical" href="/drafts/date-plots-in-R.html">

        <meta name="author" content="Rebecca Weiss" />
        <meta name="description" content="Anyone who has worked with timestamped data will tell you: dates are hard. The only reason we can use dates as a unit for analysis is because all of us silly humans agreed to honor a calendar system. Sure, we all agree that time exists; planets rotate in a reliable ..." />



    <!-- Bootstrap -->
        <link rel="stylesheet" href="/theme/css/bootstrap.readable.min.css" type="text/css"/>
    <link href="/theme/css/font-awesome.min.css" rel="stylesheet">

    <link href="/theme/css/pygments/native.css" rel="stylesheet">
    <link rel="stylesheet" href="/theme/css/style.css" type="text/css"/>
        <link href="/static/custom.css" rel="stylesheet">


</head>
<body>

<div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a href="/" class="navbar-brand">
<img src="/images/rjw_2013-8-17.jpg" width="90%"/> Rebecca Weiss            </a>
        </div>
        <div class="collapse navbar-collapse navbar-ex1-collapse">
            <ul class="nav navbar-nav">
                         <li><a href="/index.html">
                             Who am I?
                          </a></li>
                         <li><a href="/pages/tutorials/">
                             Tutorials
                          </a></li>
                         <li><a href="/pages/vita/">
                             Vita
                          </a></li>
                        <li >
                            <a href="/category/updates.html">Updates</a>
                        </li>
                        <li class="active">
                            <a href="/category/walkthroughs.html">Walkthroughs</a>
                        </li>
            </ul>
            <ul class="nav navbar-nav navbar-right">
                <li><a href="/archives.html"><i class="fa fa-th-list"></i><span class="icon-label">Archives</span></a></li>
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
</div> <!-- /.navbar -->

<div class="container">
    <div class="row">
        <div class="col-lg-12">

    <section id="content">
        <article>
            <header class="page-header">
                <h1>
                    <a href="/drafts/date-plots-in-R.html"
                       rel="bookmark"
                       title="Permalink to Simple plots using date data">
                        Simple plots using date data
                    </a>
                </h1>
            </header>
            <div class="entry-content">
                <div class="panel">
                    <div class="panel-body">
<footer class="post-info">
    <span class="label label-default">Date</span>
    <span class="published">
        <i class="fa fa-calendar"></i><time datetime="2014-04-25T15:30:00"> Fri 25 April 2014</time>
    </span>



    
</footer><!-- /.post-info -->                    </div>
                </div>
                <p>Anyone who has worked with timestamped data will tell you: dates are hard.  The only reason we can use dates as a unit for analysis is because all of us silly humans agreed to honor a calendar system.  </p>
<p>Sure, we all agree that time exists; planets rotate in a reliable fashion and the expansion of space can be measured in units of time.  But time (and by extension, dates) are denoted in units that humans can understand, and those units are agreed upon by convention and committee.  </p>
<h2>Calendar time versus system time</h2>
<p>For example, how does your computer keep track of time (also called <em>system time</em>)?  Back in ye olden days, the creation of a clock was an incredible feat of engineering and design.  We first tracked time using methods with terrible fidelity, such shadows cast by objects or the flow of water, working our way up towards increasing temporal resolution with mechanical designs that relied upon springs, gears, pendulums, and other materials that obeyed the physical laws of the universe. </p>
<p>Most modern methods of keeping track of time are now contingent on electronics that are more reliable than those earlier mechanical methods.  Computers are particularly good at keeping track of the passage of time, since at a certain level, it's basically just a tally that increments at an interval determined by digital signals (a very predictable signal).  </p>
<h2>Why should I care about epochs?</h2>
<p>But the only way you can use that tally to determine <em>date</em> the way we humans understand time is if as long as you have a reference point to compare your tally against. For most computers, that's the <strong>Unix epoch</strong> (if you are on a Windows machine, you probably are using a different value).</p>
<p>If you've ever seen a tutorial that talked about date types before, you might have seen this phrase.  More importantly, if you've ever used a reasonably well-designed date format library before, you'll probably notice that a lot of the functions try to force you to convert time to UTC or "Coordinated Universal Time."  </p>
<p>System time is typically measured in seconds from the epoch, and well-written libraries can convert system time to calendar time.  You can <a href="http://www.epochconverter.com/">follow this link</a> if you want to see what current calendar time is in Unix epoch time.  </p>
<h2>But no, seriously, should I care about epoch time?</h2>
<p>Yes, you should know what Unix epoch time is.  But generally, you can't really count on someone being so forward thinking as to record all their dates in Unix epoch time, or even to be so smart as to keep their human-readable dates and times in UTC and in a reliable machine-readable format.  For example, how many ways can you think of writing out January 1st, 2000?</p>
<ol>
<li>01/01/2000 (For you Americans)</li>
<li>01/01/2000 (For you Canadians)</li>
<li>01-01-2000</li>
<li>Jan 1 2000</li>
<li>Jan 01, 2000</li>
<li>01 Jan 2000</li>
<li>01 Jan 2000 00:00:00 PST</li>
</ol>
<p>And so on.  Maybe you're even so unlucky that someone has <em>changed the date format on you mid-file</em> (by the way, if you have done this, one I will find you and I <em>will</em> make you suffer).</p>
<h2>And now that you know a little bit about time, let's get to the point of this post: the tutorial</h2>
<p>In this post, I'm going to go through a very simple example of working with date data in <code>R</code>.  I have a bunch of data that is timestamped.  The timestamps are in human-readable strings denoting a date in human-readable calendar time.  I want to use these timestamps ordered by calendar time so that I can look at my data in a way that is meaningful to humans.  </p>
<p>I'm going to use a few handy <code>R</code> libraries: <code>ggplot</code>, <code>reshape2</code>, <code>plyr</code>, and most importantly, <code>lubridate</code>.</p>
<h2>The data we'll be using</h2>
<p>The Pew Center's Project for Excellence in Journalism has a project called the News Coverage Index.  This is an on-going research study where they keep track of news coverage over a bunch of outlets and across an array of media sectors: broadcast, network, newspaper, online, and radio news.  They have been counting various attributes of news coverage practically every day for years.  They also do some coding of the data, so you can roughly categorize news coverage by topics.</p>
<p>I have one caveat, which is that this is sample data. You really can't read too much into the meaning of the differences, because the sampling of this data means that they aren't getting <em>all</em> of the news.  To their credit, they clearly acknowledge this shortcoming, so we'll just treat this as interesting data that happens to be timestamped.</p>
<p>You have to sign an agreement in order to get the data, so I won't distribute it here.  But it's easy enough to get as long as you agree to their conditions.  In this post, I'm using the data from 2010, 2011, and the 2012 release (which only covers January to May).</p>
<h2>The code!</h2>
<p>I'm an acolyte of the Church of Wickham, so you'll see quite a bit of dependency on his packages.  I won't apologize.  He's directly contributing to the increasing value of <code>R</code>.  </p>
<p>I'll load all the libraries here:</p>
<div class="highlight"><pre>library<span class="p">(</span>foreign<span class="p">)</span>
library<span class="p">(</span>reshape2<span class="p">)</span>  <span class="c1"># Wickham</span>
library<span class="p">(</span>ggplot2<span class="p">)</span>  <span class="c1"># Wickham</span>
library<span class="p">(</span>plyr<span class="p">)</span>  <span class="c1"># Wickham</span>
library<span class="p">(</span>lubridate<span class="p">)</span>  <span class="c1"># Wickham</span>
library<span class="p">(</span>car<span class="p">)</span>
</pre></div>


<p>I'm using the <code>foreign</code> package because the Pew data comes as <code>.sav</code> files.  This package has a function <code>read.spss</code> that allows you to work with SPSS files in <code>R</code>.  You can also use <code>spss.get</code> in the <code>Hmisc</code> package; nobody is going to stop you.  I prefer the semantic continuity of <code>read.spss</code> with the other <code>read</code> functions in <code>R</code>, which is basically the only reason I use it over <code>spss.get</code>. </p>
<div class="highlight"><pre>setwd<span class="p">(</span><span class="s">&quot;/Users/rweiss/Dropbox/research/projects/NewsCoverage/&quot;</span><span class="p">)</span>  <span class="c1"># my working directory</span>
data2012 <span class="o">=</span> read.spss<span class="p">(</span><span class="s">&quot;NCI/Jan - May 2012 data TO BE RELEASED.sav&quot;</span><span class="p">,</span> to.data.frame <span class="o">=</span> <span class="k-Variable">T</span><span class="p">)</span>
data2011 <span class="o">=</span> read.spss<span class="p">(</span><span class="s">&quot;NCI/Jan1-Dec31 2011.sav&quot;</span><span class="p">,</span> to.data.frame <span class="o">=</span> <span class="k-Variable">T</span><span class="p">)</span>
data2010 <span class="o">=</span> read.spss<span class="p">(</span><span class="s">&quot;NCI/Jan 1-Dec 31 2010 for release.sav&quot;</span><span class="p">,</span> to.data.frame <span class="o">=</span> <span class="k-Variable">T</span><span class="p">)</span>
</pre></div>


<p>Note that I included <code>to.data.frame=T</code> as an argument to the <code>read.spss</code> function, otherwise <code>data2012</code>, <code>data2011</code>, and <code>data2010</code> are returned as list objects, and I prefer to work with data.frames. </p>
<p>What exactly are the dimensions of these data.frames?</p>
<div class="highlight"><pre>names<span class="p">(</span>data2012<span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span class="c">##  [1] &quot;StoryDate&quot;           &quot;StoryID&quot;             &quot;Source&quot;             </span>
<span class="c">##  [4] &quot;BroadcastStartTime&quot;  &quot;durasec&quot;             &quot;StoryWordCount&quot;     </span>
<span class="c">##  [7] &quot;PlacementProminence&quot; &quot;storyformat&quot;         &quot;BigStory&quot;           </span>
<span class="c">## [10] &quot;GeographicFocus&quot;     &quot;topicgrouped&quot;        &quot;LeadNewsmaker&quot;      </span>
<span class="c">## [13] &quot;LeadNewsmaker2&quot;      &quot;mediasector&quot;</span>
</pre></div>


<p>And what are the types of these dimensions?</p>
<div class="highlight"><pre>sapply<span class="p">(</span>data2012<span class="p">,</span> class<span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span class="c">##           StoryDate             StoryID              Source </span>
<span class="c">##           &quot;numeric&quot;           &quot;numeric&quot;            &quot;factor&quot; </span>
<span class="c">##  BroadcastStartTime             durasec      StoryWordCount </span>
<span class="c">##            &quot;factor&quot;           &quot;numeric&quot;           &quot;numeric&quot; </span>
<span class="c">## PlacementProminence         storyformat            BigStory </span>
<span class="c">##            &quot;factor&quot;            &quot;factor&quot;           &quot;numeric&quot; </span>
<span class="c">##     GeographicFocus        topicgrouped       LeadNewsmaker </span>
<span class="c">##            &quot;factor&quot;            &quot;factor&quot;            &quot;factor&quot; </span>
<span class="c">##      LeadNewsmaker2         mediasector </span>
<span class="c">##            &quot;factor&quot;            &quot;factor&quot;</span>
</pre></div>


<p>I don't really care about most of these dimensions.  Also, there's an additional annoying detail, in that 2010 and 2011 don't have the same variable labels as 2012.  </p>
<p>First, let's drop all the dimensions I don't care about.</p>
<div class="highlight"><pre>data2012_small <span class="o">=</span> subset<span class="p">(</span>data2012<span class="p">,</span> select <span class="o">=</span> c<span class="p">(</span><span class="s">&quot;StoryDate&quot;</span><span class="p">,</span> <span class="s">&quot;StoryID&quot;</span><span class="p">,</span> <span class="s">&quot;Source&quot;</span><span class="p">,</span> 
    <span class="s">&quot;mediasector&quot;</span><span class="p">,</span> <span class="s">&quot;topicgrouped&quot;</span><span class="p">,</span> <span class="s">&quot;BroadcastStartTime&quot;</span><span class="p">))</span>
data2011_small <span class="o">=</span> subset<span class="p">(</span>data2011<span class="p">,</span> select <span class="o">=</span> c<span class="p">(</span><span class="s">&quot;StoryDate&quot;</span><span class="p">,</span> <span class="s">&quot;StoryID&quot;</span><span class="p">,</span> <span class="s">&quot;Source&quot;</span><span class="p">,</span> 
    <span class="s">&quot;mediasector&quot;</span><span class="p">,</span> <span class="s">&quot;broadstorytopic&quot;</span><span class="p">,</span> <span class="s">&quot;BroadcastStartTime&quot;</span><span class="p">))</span>
data2010_small <span class="o">=</span> subset<span class="p">(</span>data2010<span class="p">,</span> select <span class="o">=</span> c<span class="p">(</span><span class="s">&quot;StoryDate&quot;</span><span class="p">,</span> <span class="s">&quot;StoryID&quot;</span><span class="p">,</span> <span class="s">&quot;Source&quot;</span><span class="p">,</span> 
    <span class="s">&quot;mediasector&quot;</span><span class="p">,</span> <span class="s">&quot;broadstorytopic&quot;</span><span class="p">,</span> <span class="s">&quot;BroadcastStartTime&quot;</span><span class="p">))</span>
</pre></div>


<p>I'll relabel all of the dimensions with the same names, because who wants to retype all those labels again?</p>
<div class="highlight"><pre>labels <span class="o">=</span> names<span class="p">(</span>data2012_small<span class="p">)</span>
names<span class="p">(</span>data2011_small<span class="p">)</span> <span class="o">=</span> labels
names<span class="p">(</span>data2010_small<span class="p">)</span> <span class="o">=</span> labels
</pre></div>


<p>Now that they have the same labels for their dimensions, I can now create one big data.frame with all three years:</p>
<div class="highlight"><pre>data <span class="o">=</span> rbind<span class="p">(</span>data2012_small<span class="p">,</span> data2011_small<span class="p">,</span> data2010_small<span class="p">)</span>
</pre></div>


<p>Another detail: the levels of a couple of the variables are not the same between the years.  I am a habitual abuser of the <code>recode</code> function in <code>car</code>, but there are loads of ways to have solved this problem.</p>
<div class="highlight"><pre>data<span class="o">$</span>mediasector <span class="o">=</span> car<span class="o">::</span>recode<span class="p">(</span>data<span class="o">$</span>mediasector<span class="p">,</span> <span class="s">&quot;&#39;network TV&#39;=&#39;network&#39;; &#39;cable TV&#39;=&#39;cable&#39;&quot;</span><span class="p">)</span>
data<span class="o">$</span>topicgrouped <span class="o">=</span> car<span class="o">::</span>recode<span class="p">(</span>data<span class="o">$</span>topicgrouped<span class="p">,</span> <span class="s">&quot;&#39;U.S. miscellaenous&#39;=&#39;U.S. miscellaneous&#39;; &#39;Economy/Economics&#39;=&#39;economy/economics&#39;&quot;</span><span class="p">)</span>
</pre></div>


<p>FYI, I discovered this inconsistency in levels when I was plotting out my code.  But you could also do something like this:</p>
<div class="highlight"><pre>sapply<span class="p">(</span>data2012_small<span class="p">,</span> levels<span class="p">)</span> <span class="o">%in%</span> sapply<span class="p">(</span>data2011_small<span class="p">,</span> levels<span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span class="c">## [1]  TRUE  TRUE FALSE  TRUE  TRUE  TRUE</span>
</pre></div>


<p>Heck, you could even put this in a table to see which years don't match:</p>
<div class="highlight"><pre>table<span class="p">(</span>names<span class="p">(</span>data<span class="p">),</span> sapply<span class="p">(</span>data2012_small<span class="p">,</span> levels<span class="p">)</span> <span class="o">%in%</span> sapply<span class="p">(</span>data2011_small<span class="p">,</span> 
    levels<span class="p">))</span>
</pre></div>


<div class="highlight"><pre><span class="c">##                     </span>
<span class="c">##                      FALSE TRUE</span>
<span class="c">##   BroadcastStartTime     0    1</span>
<span class="c">##   mediasector            0    1</span>
<span class="c">##   Source                 1    0</span>
<span class="c">##   StoryDate              0    1</span>
<span class="c">##   StoryID                0    1</span>
<span class="c">##   topicgrouped           0    1</span>
</pre></div>


<p>You'd have to mix and match the years, but you can hopefully see that there's already a mismatch in the levels of the <code>Source</code> dimension between 2012 and 2011. </p>
<h3>Dates and <code>lubridate</code></h3>
<p>The dates in this data are just strings.  Take a look at the <code>StoryDate</code> dimension:</p>
<div class="highlight"><pre>head<span class="p">(</span>data<span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span class="c">##   StoryDate StoryID   Source mediasector                 topicgrouped</span>
<span class="c">## 1  20120102  430675 NY Times   newspaper campaigns/elections/politics</span>
<span class="c">## 2  20120102  430676 NY Times   newspaper campaigns/elections/politics</span>
<span class="c">## 3  20120102  430677 NY Times   newspaper           foreign (non U.S.)</span>
<span class="c">## 4  20120102  430684 NY Times   newspaper  defense/military (domestic)</span>
<span class="c">## 5  20120102  430685 NY Times   newspaper         U.S. foreign affairs</span>
<span class="c">## 6  20120102  430686 NY Times   newspaper                        crime</span>
<span class="c">##   BroadcastStartTime</span>
<span class="c">## 1      not broadcast</span>
<span class="c">## 2      not broadcast</span>
<span class="c">## 3      not broadcast</span>
<span class="c">## 4      not broadcast</span>
<span class="c">## 5      not broadcast</span>
<span class="c">## 6      not broadcast</span>
</pre></div>


<p>I'm curious to see what the relative proportion of coverage per topic is over various time dimensions: day of the week, per month, and per week in the year.  To do this, I first need to compute the proportion of topic coverage per day:</p>
<div class="highlight"><pre>data_prop <span class="o">=</span> ddply<span class="p">(</span>data<span class="p">,</span> .<span class="p">(</span>StoryDate<span class="p">,</span> mediasector<span class="p">,</span> BroadcastStartTime<span class="p">),</span> <span class="kr">function</span><span class="p">(</span>x<span class="p">)</span> <span class="p">{</span>
    prop.table<span class="p">(</span>table<span class="p">(</span>x<span class="o">$</span>topicgrouped<span class="p">))</span>
<span class="p">})</span>
head<span class="p">(</span>data_prop<span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span class="c">##   StoryDate mediasector           BroadcastStartTime</span>
<span class="c">## 1  20100101       cable afternoon program (noon-5pm)</span>
<span class="c">## 2  20100101       cable   evening program (5pm-11pm)</span>
<span class="c">## 3  20100101     network   morning program (5am-noon)</span>
<span class="c">## 4  20100101     network   evening program (5pm-11pm)</span>
<span class="c">## 5  20100101   newspaper                not broadcast</span>
<span class="c">## 6  20100101      online                not broadcast</span>
<span class="c">##   additional domestic affairs business campaigns/elections/politics</span>
<span class="c">## 1                     0.10000  0.10000                      0.00000</span>
<span class="c">## 2                     0.03571  0.03571                      0.03571</span>
<span class="c">## 3                     0.00000  0.00000                      0.04348</span>
<span class="c">## 4                     0.00000  0.06250                      0.00000</span>
<span class="c">## 5                     0.10000  0.10000                      0.10000</span>
<span class="c">## 6                     0.00000  0.06667                      0.03333</span>
<span class="c">##   celebrity/entertainment court/legal system crime</span>
<span class="c">## 1                 0.00000                  0   0.1</span>
<span class="c">## 2                 0.00000                  0   0.0</span>
<span class="c">## 3                 0.00000                  0   0.0</span>
<span class="c">## 4                 0.03125                  0   0.0</span>
<span class="c">## 5                 0.00000                  0   0.0</span>
<span class="c">## 6                 0.00000                  0   0.0</span>
<span class="c">##   defense/military (domestic) development/sprawl disasters/accidents</span>
<span class="c">## 1                         0.1                  0             0.00000</span>
<span class="c">## 2                         0.0                  0             0.03571</span>
<span class="c">## 3                         0.0                  0             0.00000</span>
<span class="c">## 4                         0.0                  0             0.00000</span>
<span class="c">## 5                         0.0                  0             0.00000</span>
<span class="c">## 6                         0.0                  0             0.00000</span>
<span class="c">##   domestic terrorism economy/economics education environment</span>
<span class="c">## 1            0.00000           0.00000   0.00000     0.00000</span>
<span class="c">## 2            0.03571           0.03571   0.00000     0.03571</span>
<span class="c">## 3            0.08696           0.17391   0.00000     0.00000</span>
<span class="c">## 4            0.09375           0.00000   0.00000     0.00000</span>
<span class="c">## 5            0.20000           0.20000   0.00000     0.00000</span>
<span class="c">## 6            0.06667           0.03333   0.03333     0.06667</span>
<span class="c">##   foreign (non U.S.) government agencies/legislatures health/medicine</span>
<span class="c">## 1            0.00000                          0.00000         0.00000</span>
<span class="c">## 2            0.03571                          0.21429         0.10714</span>
<span class="c">## 3            0.00000                          0.04348         0.04348</span>
<span class="c">## 4            0.12500                          0.21875         0.00000</span>
<span class="c">## 5            0.00000                          0.00000         0.10000</span>
<span class="c">## 6            0.13333                          0.03333         0.03333</span>
<span class="c">##   immigration lifestyle   media race/gender/gay issues religion</span>
<span class="c">## 1           0   0.00000 0.10000                0.00000        0</span>
<span class="c">## 2           0   0.00000 0.07143                0.03571        0</span>
<span class="c">## 3           0   0.04348 0.08696                0.04348        0</span>
<span class="c">## 4           0   0.06250 0.03125                0.00000        0</span>
<span class="c">## 5           0   0.00000 0.00000                0.00000        0</span>
<span class="c">## 6           0   0.06667 0.00000                0.00000        0</span>
<span class="c">##   science and technology sports transportation U.S. foreign affairs</span>
<span class="c">## 1                0.00000 0.0000        0.00000               0.5000</span>
<span class="c">## 2                0.10714 0.0000        0.07143               0.1071</span>
<span class="c">## 3                0.00000 0.0000        0.00000               0.1304</span>
<span class="c">## 4                0.03125 0.0625        0.00000               0.1875</span>
<span class="c">## 5                0.00000 0.0000        0.10000               0.1000</span>
<span class="c">## 6                0.00000 0.0000        0.00000               0.3333</span>
<span class="c">##   U.S. miscellaneous</span>
<span class="c">## 1            0.00000</span>
<span class="c">## 2            0.00000</span>
<span class="c">## 3            0.30435</span>
<span class="c">## 4            0.09375</span>
<span class="c">## 5            0.00000</span>
<span class="c">## 6            0.10000</span>
</pre></div>


<p>To verify, let's make sure everything sums to 1 per day, by media sector, and per broadcast time:</p>
<div class="highlight"><pre>topics <span class="o">=</span> levels<span class="p">(</span>data<span class="o">$</span>topicgrouped<span class="p">)</span>
proportion_check <span class="o">=</span> ddply<span class="p">(</span>data_prop<span class="p">,</span> .<span class="p">(</span>mediasector<span class="p">,</span> StoryDate<span class="p">,</span> BroadcastStartTime<span class="p">),</span> 
    <span class="kr">function</span><span class="p">(</span>x<span class="p">)</span> <span class="p">{</span>
        rowSums<span class="p">(</span>x<span class="p">[,</span> which<span class="p">(</span>names<span class="p">(</span>x<span class="p">)</span> <span class="o">%in%</span> topics<span class="p">)])</span>
    <span class="p">})</span>
summary<span class="p">(</span>proportion_check<span class="o">$</span>V1<span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span class="c">##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span>
<span class="c">##       1       1       1       1       1       1</span>
</pre></div>


<p>Here comes the date challenge.  <code>StoryDate</code> is just a string.  It doesn't contain the inherent meaningful nature of calendar dates as we humans recognize dates to have.  </p>
<p>Most programming languages have developed various utilities to help with handling dates as data types.  In <code>R</code>, we have the <code>lubridate</code> package.  </p>
<p>Normally, you'd have to do something with date expressions and <code>strptime</code> in order to convert a string to a date (or <code>strftime</code> if you wanted to convert from date to string).  This is a completely acceptable solution, and everyone should probably spend some time working through those functions in order to get a better sense of how computers work with simple date and time expressions.</p>
<p>On the other hand, <code>lubridate</code> comes with a variety of functions that make it really easy to extract calendar date information from objects like strings.  Going further, it has a bunch of handy functions to work with abstractions of calendar concepts that we humans care about; for example, day of the week, month, and week of the year.  </p>
<div class="highlight"><pre>data_prop<span class="o">$</span>StoryDate <span class="o">=</span> ymd<span class="p">(</span>data_prop<span class="o">$</span>StoryDate<span class="p">)</span>
data_prop<span class="o">$</span>month <span class="o">=</span> month<span class="p">(</span>data_prop<span class="o">$</span>StoryDate<span class="p">,</span> label <span class="o">=</span> <span class="kc">TRUE</span><span class="p">,</span> abbr <span class="o">=</span> <span class="kc">TRUE</span><span class="p">)</span>
data_prop<span class="o">$</span>week <span class="o">=</span> week<span class="p">(</span>data_prop<span class="o">$</span>StoryDate<span class="p">)</span>
data_prop<span class="o">$</span>wday <span class="o">=</span> wday<span class="p">(</span>data_prop<span class="o">$</span>StoryDate<span class="p">,</span> label <span class="o">=</span> <span class="kc">TRUE</span><span class="p">,</span> abbr <span class="o">=</span> <span class="kc">TRUE</span><span class="p">)</span>
</pre></div>


<p>And that is basically it, friends.  Here's what that looks like:</p>
<div class="highlight"><pre>head<span class="p">(</span>data_prop<span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span class="c">##    StoryDate mediasector           BroadcastStartTime</span>
<span class="c">## 1 2010-01-01       cable afternoon program (noon-5pm)</span>
<span class="c">## 2 2010-01-01       cable   evening program (5pm-11pm)</span>
<span class="c">## 3 2010-01-01     network   morning program (5am-noon)</span>
<span class="c">## 4 2010-01-01     network   evening program (5pm-11pm)</span>
<span class="c">## 5 2010-01-01   newspaper                not broadcast</span>
<span class="c">## 6 2010-01-01      online                not broadcast</span>
<span class="c">##   additional domestic affairs business campaigns/elections/politics</span>
<span class="c">## 1                     0.10000  0.10000                      0.00000</span>
<span class="c">## 2                     0.03571  0.03571                      0.03571</span>
<span class="c">## 3                     0.00000  0.00000                      0.04348</span>
<span class="c">## 4                     0.00000  0.06250                      0.00000</span>
<span class="c">## 5                     0.10000  0.10000                      0.10000</span>
<span class="c">## 6                     0.00000  0.06667                      0.03333</span>
<span class="c">##   celebrity/entertainment court/legal system crime</span>
<span class="c">## 1                 0.00000                  0   0.1</span>
<span class="c">## 2                 0.00000                  0   0.0</span>
<span class="c">## 3                 0.00000                  0   0.0</span>
<span class="c">## 4                 0.03125                  0   0.0</span>
<span class="c">## 5                 0.00000                  0   0.0</span>
<span class="c">## 6                 0.00000                  0   0.0</span>
<span class="c">##   defense/military (domestic) development/sprawl disasters/accidents</span>
<span class="c">## 1                         0.1                  0             0.00000</span>
<span class="c">## 2                         0.0                  0             0.03571</span>
<span class="c">## 3                         0.0                  0             0.00000</span>
<span class="c">## 4                         0.0                  0             0.00000</span>
<span class="c">## 5                         0.0                  0             0.00000</span>
<span class="c">## 6                         0.0                  0             0.00000</span>
<span class="c">##   domestic terrorism economy/economics education environment</span>
<span class="c">## 1            0.00000           0.00000   0.00000     0.00000</span>
<span class="c">## 2            0.03571           0.03571   0.00000     0.03571</span>
<span class="c">## 3            0.08696           0.17391   0.00000     0.00000</span>
<span class="c">## 4            0.09375           0.00000   0.00000     0.00000</span>
<span class="c">## 5            0.20000           0.20000   0.00000     0.00000</span>
<span class="c">## 6            0.06667           0.03333   0.03333     0.06667</span>
<span class="c">##   foreign (non U.S.) government agencies/legislatures health/medicine</span>
<span class="c">## 1            0.00000                          0.00000         0.00000</span>
<span class="c">## 2            0.03571                          0.21429         0.10714</span>
<span class="c">## 3            0.00000                          0.04348         0.04348</span>
<span class="c">## 4            0.12500                          0.21875         0.00000</span>
<span class="c">## 5            0.00000                          0.00000         0.10000</span>
<span class="c">## 6            0.13333                          0.03333         0.03333</span>
<span class="c">##   immigration lifestyle   media race/gender/gay issues religion</span>
<span class="c">## 1           0   0.00000 0.10000                0.00000        0</span>
<span class="c">## 2           0   0.00000 0.07143                0.03571        0</span>
<span class="c">## 3           0   0.04348 0.08696                0.04348        0</span>
<span class="c">## 4           0   0.06250 0.03125                0.00000        0</span>
<span class="c">## 5           0   0.00000 0.00000                0.00000        0</span>
<span class="c">## 6           0   0.06667 0.00000                0.00000        0</span>
<span class="c">##   science and technology sports transportation U.S. foreign affairs</span>
<span class="c">## 1                0.00000 0.0000        0.00000               0.5000</span>
<span class="c">## 2                0.10714 0.0000        0.07143               0.1071</span>
<span class="c">## 3                0.00000 0.0000        0.00000               0.1304</span>
<span class="c">## 4                0.03125 0.0625        0.00000               0.1875</span>
<span class="c">## 5                0.00000 0.0000        0.10000               0.1000</span>
<span class="c">## 6                0.00000 0.0000        0.00000               0.3333</span>
<span class="c">##   U.S. miscellaneous month week wday</span>
<span class="c">## 1            0.00000   Jan    1  Fri</span>
<span class="c">## 2            0.00000   Jan    1  Fri</span>
<span class="c">## 3            0.30435   Jan    1  Fri</span>
<span class="c">## 4            0.09375   Jan    1  Fri</span>
<span class="c">## 5            0.00000   Jan    1  Fri</span>
<span class="c">## 6            0.10000   Jan    1  Fri</span>
</pre></div>


<p>Again, I'm a practitioner of the Hadley school of R, so I rely heavily on his approach to processing data.  Before I move into plotting, I'm going to take this <em>wide</em> data (lots of dimensions) and convert it to a <em>long</em> form of data, where I have some variables that will be useful as a dimensional mapping in the eventual plot, and some variables that will serve as the actual measured values.</p>
<p>I'll create a variety of separate data.frames that will be used solely for each of these time units, just to illustrate some examples of how these pieces can fit together. </p>
<div class="highlight"><pre><span class="c1"># Melt data from wide to long</span>
melted_data <span class="o">=</span> melt<span class="p">(</span>data_prop<span class="p">,</span> id.vars <span class="o">=</span> c<span class="p">(</span><span class="s">&quot;StoryDate&quot;</span><span class="p">,</span> <span class="s">&quot;mediasector&quot;</span><span class="p">,</span> <span class="s">&quot;wday&quot;</span><span class="p">,</span> 
    <span class="s">&quot;month&quot;</span><span class="p">,</span> <span class="s">&quot;week&quot;</span><span class="p">,</span> <span class="s">&quot;BroadcastStartTime&quot;</span><span class="p">))</span>

<span class="c1"># Pew only gathered newspapers on Sunday, so let&#39;s ignore for now</span>
melted_data <span class="o">=</span> melted_data<span class="p">[</span>melted_data<span class="o">$</span>wday <span class="o">!=</span> <span class="s">&quot;Sun&quot;</span><span class="p">,</span> <span class="p">]</span>

<span class="c1"># Average down to the weekday</span>

melted_data_total <span class="o">=</span> ddply<span class="p">(</span>melted_data<span class="p">,</span> .<span class="p">(</span>variable<span class="p">,</span> mediasector<span class="p">),</span> summarise<span class="p">,</span> 
    value <span class="o">=</span> mean<span class="p">(</span>as.numeric<span class="p">(</span>value<span class="p">),</span> na.rm <span class="o">=</span> <span class="k-Variable">T</span><span class="p">))</span>

melted_data_wday <span class="o">=</span> ddply<span class="p">(</span>melted_data<span class="p">,</span> .<span class="p">(</span>wday<span class="p">,</span> variable<span class="p">,</span> mediasector<span class="p">),</span> summarise<span class="p">,</span> 
    value <span class="o">=</span> mean<span class="p">(</span>as.numeric<span class="p">(</span>value<span class="p">),</span> na.rm <span class="o">=</span> <span class="k-Variable">T</span><span class="p">))</span>

melted_data_week <span class="o">=</span> ddply<span class="p">(</span>melted_data<span class="p">,</span> .<span class="p">(</span>week<span class="p">,</span> variable<span class="p">,</span> mediasector<span class="p">),</span> summarise<span class="p">,</span> 
    value <span class="o">=</span> mean<span class="p">(</span>as.numeric<span class="p">(</span>value<span class="p">),</span> na.rm <span class="o">=</span> <span class="k-Variable">T</span><span class="p">))</span>

melted_data_month <span class="o">=</span> ddply<span class="p">(</span>melted_data<span class="p">,</span> .<span class="p">(</span>month<span class="p">,</span> variable<span class="p">,</span> mediasector<span class="p">),</span> summarise<span class="p">,</span> 
    value <span class="o">=</span> mean<span class="p">(</span>as.numeric<span class="p">(</span>value<span class="p">),</span> na.rm <span class="o">=</span> <span class="k-Variable">T</span><span class="p">))</span>
</pre></div>


<h3>What's the proportion of news coverage related to crime by media sector?</h3>
<div class="highlight"><pre>ggplot<span class="p">(</span>melted_data_total<span class="p">[</span>melted_data_total<span class="o">$</span>variable <span class="o">%in%</span> <span class="s">&quot;crime&quot;</span><span class="p">,</span> <span class="p">],</span> aes<span class="p">(</span>x <span class="o">=</span> mediasector<span class="p">,</span> 
    y <span class="o">=</span> value<span class="p">,</span> fill <span class="o">=</span> mediasector<span class="p">))</span> <span class="o">+</span> geom_histogram<span class="p">(</span>stat <span class="o">=</span> <span class="s">&quot;identity&quot;</span><span class="p">,</span> position <span class="o">=</span> <span class="s">&quot;dodge&quot;</span><span class="p">)</span> <span class="o">+</span> 
    <span class="c1"># coord_flip() +</span>
ggtitle<span class="p">(</span><span class="s">&quot;Proportional news attention: Crime coverage&quot;</span><span class="p">)</span> <span class="o">+</span> xlab<span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">)</span> <span class="o">+</span> ylab<span class="p">(</span><span class="s">&quot;Proportion of coverage&quot;</span><span class="p">)</span>
</pre></div>


<p><img alt="plot of chunk unnamed-chunk-17" src="../../images/dateplot-unnamed-chunk-17.svg" /> </p>
<h3>Does the day of the week relate to proportion of disaster coverage?</h3>
<div class="highlight"><pre>ggplot<span class="p">(</span>melted_data_wday<span class="p">[</span>melted_data_wday<span class="o">$</span>variable <span class="o">%in%</span> <span class="s">&quot;disasters/accidents&quot;</span><span class="p">,</span> 
    <span class="p">],</span> aes<span class="p">(</span>x <span class="o">=</span> wday<span class="p">,</span> y <span class="o">=</span> value<span class="p">,</span> fill <span class="o">=</span> mediasector<span class="p">))</span> <span class="o">+</span> geom_histogram<span class="p">(</span>stat <span class="o">=</span> <span class="s">&quot;identity&quot;</span><span class="p">,</span> 
    position <span class="o">=</span> <span class="s">&quot;dodge&quot;</span><span class="p">)</span> <span class="o">+</span> ggtitle<span class="p">(</span><span class="s">&quot;Proportional news attention: Disaster/Accident coverage&quot;</span><span class="p">)</span> <span class="o">+</span> 
    xlab<span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">)</span> <span class="o">+</span> ylab<span class="p">(</span><span class="s">&quot;Proportion of coverage&quot;</span><span class="p">)</span>
</pre></div>


<p><img alt="plot of chunk unnamed-chunk-18" src="../../images/dateplot-unnamed-chunk-18.svg" /> </p>
<h3>Do we see more economic coverage in some months over others?</h3>
<div class="highlight"><pre>ggplot<span class="p">(</span>melted_data_month<span class="p">[</span>melted_data_month<span class="o">$</span>variable <span class="o">%in%</span> <span class="s">&quot;economy/economics&quot;</span><span class="p">,</span> 
    <span class="p">],</span> aes<span class="p">(</span>x <span class="o">=</span> month<span class="p">,</span> y <span class="o">=</span> value<span class="p">,</span> fill <span class="o">=</span> mediasector<span class="p">))</span> <span class="o">+</span> geom_histogram<span class="p">(</span>stat <span class="o">=</span> <span class="s">&quot;identity&quot;</span><span class="p">,</span> 
    position <span class="o">=</span> <span class="s">&quot;dodge&quot;</span><span class="p">)</span> <span class="o">+</span> ggtitle<span class="p">(</span><span class="s">&quot;Proportional news attention: Economic coverage&quot;</span><span class="p">)</span> <span class="o">+</span> 
    xlab<span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">)</span> <span class="o">+</span> ylab<span class="p">(</span><span class="s">&quot;Proportion of coverage&quot;</span><span class="p">)</span>
</pre></div>


<p><img alt="plot of chunk unnamed-chunk-19" src="../../images/dateplot-unnamed-chunk-19.svg" /> </p>
<h3>Behold!  The electoral horse race news coverage by week of the year.</h3>
<div class="highlight"><pre>ggplot<span class="p">(</span>melted_data_week<span class="p">[</span>melted_data_week<span class="o">$</span>variable <span class="o">%in%</span> <span class="s">&quot;campaigns/elections/politics&quot;</span><span class="p">,</span> 
    <span class="p">],</span> aes<span class="p">(</span>x <span class="o">=</span> week<span class="p">,</span> y <span class="o">=</span> value<span class="p">,</span> fill <span class="o">=</span> mediasector<span class="p">))</span> <span class="o">+</span> geom_histogram<span class="p">(</span>stat <span class="o">=</span> <span class="s">&quot;identity&quot;</span><span class="p">,</span> 
    position <span class="o">=</span> <span class="s">&quot;dodge&quot;</span><span class="p">)</span> <span class="o">+</span> ggtitle<span class="p">(</span><span class="s">&quot;Proportional news attention: Campaigns and politics coverage&quot;</span><span class="p">)</span> <span class="o">+</span> 
    xlab<span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">)</span> <span class="o">+</span> ylab<span class="p">(</span><span class="s">&quot;Proportion of coverage&quot;</span><span class="p">)</span>
</pre></div>


<p><img alt="plot of chunk unnamed-chunk-20" src="../../images/dateplot-unnamed-chunk-20.svg" /> </p>
            </div>
            <!-- /.entry-content -->
    <hr/>
    <section class="comments" id="comments">
        <h2>Comments</h2>

        <div id="disqus_thread"></div>
        <script type="text/javascript">
            /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
            var disqus_shortname = 'rebeccaweissinfo'; // required: replace example with your forum shortname

                    var disqus_identifier = 'date-plots-in-R';
                var disqus_url = '/drafts/date-plots-in-R.html';

            var disqus_config = function () {
                this.language = "en";
            };

            /* * * DON'T EDIT BELOW THIS LINE * * */
            (function () {
                var dsq = document.createElement('script');
                dsq.type = 'text/javascript';
                dsq.async = true;
                dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
            })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by
            Disqus.</a></noscript>
        <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

    </section>
        </article>
    </section>

        </div>
    </div>
</div>
<footer>
   <div class="container">
      <hr>
      <div class="row">
         <div class="col-xs-10">&copy; 2014 Rebecca Weiss
            &middot; Powered by <a href="https://github.com/DandyDev/pelican-bootstrap3" target="_blank">pelican-bootstrap3</a>,
            <a href="http://docs.getpelican.com/" target="_blank">Pelican</a>,
            <a href="http://getbootstrap.com" target="_blank">Bootstrap</a>         </div>
         <div class="col-xs-2"><p class="pull-right"><i class="fa fa-arrow-up"></i> <a href="#">Back to top</a></p></div>
      </div>
   </div>
</footer>
<script src="/theme/js/jquery.min.js"></script>

<!-- Include all compiled plugins (below), or include individual files as needed -->
<script src="/theme/js/bootstrap.min.js"></script>

<!-- Enable responsive features in IE8 with Respond.js (https://github.com/scottjehl/Respond) -->
<script src="/theme/js/respond.min.js"></script>

    <!-- GitHub JS -->
    <script type="text/javascript">
        $(document).ready(function () {
            if (!window.jXHR) {
                var jxhr = document.createElement('script');
                jxhr.type = 'text/javascript';
                jxhr.src = '/theme/js/jXHR.js';
                var s = document.getElementsByTagName('script')[0];
                s.parentNode.insertBefore(jxhr, s);
            }

            github.showRepos({
                user: 'rjweiss',
                count: 3,
                skip_forks: true,
                target: '#gh_repos'
            });
        });
    </script>
    <script src="/theme/js/github.js" type="text/javascript"></script>
    <!-- End GitHub JS Code -->
    <!-- Disqus -->
    <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'rebeccaweissinfo'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function () {
            var s = document.createElement('script');
            s.async = true;
            s.type = 'text/javascript';
            s.src = '//' + disqus_shortname + '.disqus.com/count.js';
            (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
        }());
    </script>
    <!-- End Disqus Code -->
    <!-- Google Analytics -->
    <script type="text/javascript">

        var _gaq = _gaq || [];
        _gaq.push(['_setAccount', 'UA-39179035-2']);
        _gaq.push(['_trackPageview']);

        (function () {
            var ga = document.createElement('script');
            ga.type = 'text/javascript';
            ga.async = true;
            ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(ga, s);
        })();
    </script>
    <!-- End Google Analytics Code -->
</body>
</html>